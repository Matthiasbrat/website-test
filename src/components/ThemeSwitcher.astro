---
import { themes, darkThemes, lightThemes } from '../lib/themes';
---

<div class="relative" id="theme-switcher">
  <button
    id="theme-toggle-btn"
    class="p-2 rounded-lg hover:bg-bg-hover transition-colors"
    aria-label="Change theme"
    title="Change theme"
  >
    <!-- Sun icon (shown in dark mode) -->
    <svg class="w-5 h-5 hidden dark-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
    </svg>
    <!-- Moon icon (shown in light mode) -->
    <svg class="w-5 h-5 hidden light-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
    </svg>
    <!-- Palette icon (default) -->
    <svg class="w-5 h-5 palette-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
    </svg>
  </button>

  <!-- Theme dropdown -->
  <div
    id="theme-dropdown"
    class="hidden absolute right-0 top-full mt-2 w-64 max-h-96 overflow-y-auto rounded-xl bg-bg-secondary border border-border-default shadow-lg z-50"
  >
    <div class="p-2">
      <div class="px-3 py-2 text-xs font-semibold text-text-secondary uppercase tracking-wider">
        Dark Themes
      </div>
      {darkThemes.map((theme) => (
        <button
          class="theme-option w-full px-3 py-2 text-left rounded-lg hover:bg-bg-hover transition-colors flex items-center gap-2"
          data-theme={theme.id}
        >
          <span class="w-3 h-3 rounded-full border border-border-default" style={`background-color: var(--accent)`}></span>
          <span>{theme.name}</span>
        </button>
      ))}

      <div class="px-3 py-2 mt-2 text-xs font-semibold text-text-secondary uppercase tracking-wider border-t border-border-subtle pt-4">
        Light Themes
      </div>
      {lightThemes.map((theme) => (
        <button
          class="theme-option w-full px-3 py-2 text-left rounded-lg hover:bg-bg-hover transition-colors flex items-center gap-2"
          data-theme={theme.id}
        >
          <span class="w-3 h-3 rounded-full border border-border-default"></span>
          <span>{theme.name}</span>
        </button>
      ))}
    </div>
  </div>
</div>

<script>
  const toggleBtn = document.getElementById('theme-toggle-btn');
  const dropdown = document.getElementById('theme-dropdown');
  const themeOptions = document.querySelectorAll('.theme-option');

  const themes = [
    'one-dark', 'one-light', 'dracula', 'nord', 'solarized-dark', 'solarized-light',
    'github-dark', 'github-light', 'monokai', 'monokai-pro', 'gruvbox-dark', 'gruvbox-light',
    'tokyo-night', 'tokyo-night-light', 'catppuccin-mocha', 'catppuccin-macchiato',
    'catppuccin-frappe', 'catppuccin-latte', 'palenight', 'synthwave84', 'ayu-dark',
    'ayu-light', 'ayu-mirage', 'material-dark', 'material-light', 'material-ocean',
    'night-owl', 'light-owl', 'cobalt2', 'shades-of-purple', 'horizon-dark',
    'horizon-light', 'andromeda', 'vesper', 'rose-pine', 'rose-pine-moon',
    'rose-pine-dawn', 'everforest-dark', 'everforest-light', 'kanagawa', 'oxocarbon',
    'matthias'
  ];

  function setTheme(themeId: string) {
    const html = document.documentElement;
    themes.forEach(t => html.classList.remove('theme-' + t));
    html.classList.add('theme-' + themeId);
    localStorage.setItem('theme', themeId);
    updateActiveTheme(themeId);
  }

  function updateActiveTheme(themeId: string) {
    themeOptions.forEach(option => {
      const isActive = option.getAttribute('data-theme') === themeId;
      option.classList.toggle('bg-bg-active', isActive);
      option.classList.toggle('text-accent', isActive);
    });
  }

  // Toggle dropdown
  toggleBtn?.addEventListener('click', (e) => {
    e.stopPropagation();
    dropdown?.classList.toggle('hidden');
  });

  // Theme selection
  themeOptions.forEach(option => {
    option.addEventListener('click', () => {
      const themeId = option.getAttribute('data-theme');
      if (themeId) {
        setTheme(themeId);
        dropdown?.classList.add('hidden');
      }
    });
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', (e) => {
    if (!dropdown?.contains(e.target as Node) && !toggleBtn?.contains(e.target as Node)) {
      dropdown?.classList.add('hidden');
    }
  });

  // Initialize active state
  const currentTheme = localStorage.getItem('theme') || 'github-light';
  updateActiveTheme(currentTheme);
</script>
